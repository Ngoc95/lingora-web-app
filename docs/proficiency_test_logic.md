# Proficiency Test (Adaptive Test) Logic & API Spec

Tài liệu này mô tả luồng hoạt động, logic tính điểm và đặc tả API của bài kiểm tra trình độ đầu vào (Adaptive Test).

## 1. Tổng quan (Overview)

*   **Mục đích**: Xác định trình độ tiếng Anh (Beginner, Intermediate, Advanced).
*   **Cơ chế**: Adaptive Test. Server quyết định câu hỏi tiếp theo dựa trên lịch sử trả lời của client.
*   **Client Logic**: Không lưu ngân hàng câu hỏi. Gọi API lấy câu hỏi từng "nhịp" (step-by-step).

## 2. Luồng xử lý (Step-by-Step Flow)

1.  **Start Test**: Client gọi API `getNextQuestion` với body rỗng (hoặc `answeredQuestions: []`).
2.  **Display Question**: Hiển thị câu hỏi (`nextQuestion` trong response) cho user.
3.  **User Answer**: User chọn đáp án -> Bấm Submit.
4.  **Fetch Next & Feedback**:
    *   Client gọi API `getNextQuestion` với danh sách câu trả lời đã tích lũy (bao gồm câu vừa làm).
    *   Server trả về: `answerEvaluations` (đúng/sai của câu vừa làm) và `nextQuestion` (câu mới).
    *   Client hiển thị Feedback (Đúng/Sai) cho câu vừa làm.
5.  **Next Question**: User bấm "Tiếp tục" -> Client hiển thị `nextQuestion` mới nhận được.
6.  **End Test**: Logic lặp lại cho đến khi response trả về `isCompleted: true`. Hiển thị kết quả `proficiency`.

## 3. API Specification

Chỉ có một API endpoint chính đảm nhiệm cả việc bắt đầu, nộp câu trả lời và lấy câu hỏi mới.

### 3.1. Get Next Question (Start/Submit/Continue)

*   **Endpoint:** `/adaptive-test/next`
*   **Method:** `POST`
*   **Content-Type:** `application/json`

#### Request Body
Gửi lên danh sách **tất cả** các câu đã trả lời từ đầu bài test đến hiện tại.
*   Để bắt đầu bài test: Gửi danh sách rỗng `[]`.

```json
{
  "answeredQuestions": [
    {
      "questionId": 101,
      "answer": "A"
    },
    {
      "questionId": 205,
      "answer": "C"
    }
  ]
}
```

#### Response (Success - 200 OK)

*   `answerEvaluations`: Danh sách đánh giá đúng sai. Frontend dùng item cuối cùng để check câu vừa làm.
*   `nextQuestion`: Câu hỏi tiếp theo cần hiển thị. `null` nếu `isCompleted = true`.
*   `currentProficiency`: Trình độ ước tính tức thời.
*   `proficiency`: Trình độ cuối cùng (chỉ có giá trị khi `isCompleted = true`).

```json
{
  "data": {
    "currentProficiency": "BEGINNER",
    "answeredCount": 2,
    "isCompleted": false,
    "proficiency": null, // Final result (null if not finished)
    
    // Câu hỏi tiếp theo
    "nextQuestion": {
      "id": 301,
      "skill": "GRAMMAR",
      "text": "Choose the correct sentence:",
      "passage": null, // Có thể null hoặc string
      "options": ["She don't like apples", "She doesn't likes apples", "She doesn't like apples", "She don't likes apples"],
      "proficiency": "BEGINNER"
    },
    
    // Đánh giá các câu đã trả lời
    "answerEvaluations": [
      {
        "questionId": 101,
        "isCorrect": true,
        "correctAnswer": "A",
        "proficiency": "BEGINNER"
      },
      {
        "questionId": 205,
        "isCorrect": false,
        "correctAnswer": "B", // Đáp án đúng server trả về để user biết sai chỗ nào
        "proficiency": "BEGINNER"
      }
    ]
  },
  "status": 200
}
```

### 3.2 Get Question Bank (Optional)

Dùng nếu muốn lấy meta-data hoặc cache, nhưng luồng chính vẫn nên dùng API `next`.

*   **Endpoint:** `/adaptive-test/questions`
*   **Method:** `GET`

## 4. Notes for Frontend

*   **State Management**: Cần lưu biến mảng `answeredQuestions` trong state của component/store.
*   **Feedback/Loading**:
    *   Khi user bấm "Submit Answer": Show loading state -> Gọi API -> Nhận response -> Show Correct/Wrong UI.
    *   Khi user bấm "Continue": Clear Feedback UI -> Render `nextQuestion`.
*   **Routing**:
    *   Sau khi nhận `isCompleted: true`, hiển thị màn hình kết quả với `data.proficiency`.
    *   Nút "Finish" ở màn hình kết quả sẽ redirect về Dashboard.

---
*Generated by Antigravity for FE Web Team alignment.*
